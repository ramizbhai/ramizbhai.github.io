---
// Web3Forms Access Key - Get your free access key from https://web3forms.com/
// Just visit the website, enter your email, and you'll get an access key instantly
// No signup required, free forever, 250 submissions/month
// Use environment variable for security (set in .env file or deployment platform)
const WEB3FORMS_ACCESS_KEY = import.meta.env.PUBLIC_WEB3FORMS_ACCESS_KEY || 'YOUR_ACCESS_KEY_HERE';
const RECIPIENT_EMAIL = 'Ramizbhaipinjara@gmail.com';
---

<form
  id="contact-form"
  class="glass border"
  data-access-key={WEB3FORMS_ACCESS_KEY}
  data-recipient-email={RECIPIENT_EMAIL}
  style="border-color: var(--color-border); border-radius: var(--radius-lg); padding: var(--card-padding-md); display: flex; flex-direction: column; gap: var(--spacing-form-gap);"
>
  <div class="relative form-group">
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full bg-slate-800/30 border text-slate-100 placeholder-transparent peer focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 transition-all"
      style="border-color: var(--color-border); border-radius: var(--radius-lg); padding-top: calc(var(--input-padding-y) + 0.5rem); padding-bottom: var(--input-padding-y); padding-left: var(--input-padding-x); padding-right: var(--input-padding-x); font-size: var(--font-size-base);"
      placeholder="Your name"
    />
    <label
      for="name"
      class="absolute text-slate-400 transition-all duration-200 pointer-events-none"
      style="left: var(--input-padding-x); top: var(--input-padding-y); font-size: var(--font-size-base); line-height: 1.5;"
    >
      Name <span class="text-red-400">*</span>
    </label>
  </div>
  
  <div class="relative form-group">
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full bg-slate-800/30 border text-slate-100 placeholder-transparent peer focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 transition-all"
      style="border-color: var(--color-border); border-radius: var(--radius-lg); padding-top: calc(var(--input-padding-y) + 0.5rem); padding-bottom: var(--input-padding-y); padding-left: var(--input-padding-x); padding-right: var(--input-padding-x); font-size: var(--font-size-base);"
      placeholder="your.email@example.com"
    />
    <label
      for="email"
      class="absolute text-slate-400 transition-all duration-200 pointer-events-none"
      style="left: var(--input-padding-x); top: var(--input-padding-y); font-size: var(--font-size-base); line-height: 1.5;"
    >
      Email <span class="text-red-400">*</span>
    </label>
  </div>
  
  <div class="relative form-group">
    <textarea
      id="message"
      name="message"
      required
      rows="6"
      class="w-full bg-slate-800/30 border text-slate-100 placeholder-transparent peer focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 transition-all resize-none"
      style="border-color: var(--color-border); border-radius: var(--radius-lg); padding-top: calc(var(--input-padding-y) + 0.5rem); padding-bottom: var(--input-padding-y); padding-left: var(--input-padding-x); padding-right: var(--input-padding-x); font-size: var(--font-size-base);"
      placeholder="Your message here..."
    ></textarea>
    <label
      for="message"
      class="absolute text-slate-400 transition-all duration-200 pointer-events-none"
      style="left: var(--input-padding-x); top: var(--input-padding-y); font-size: var(--font-size-base); line-height: 1.5;"
    >
      Message <span class="text-red-400">*</span>
    </label>
  </div>
  
  <button
    type="submit"
    class="btn-primary w-full relative overflow-hidden group"
    style="font-size: var(--font-size-base); padding: var(--button-padding-y) var(--button-padding-x); border-radius: var(--radius-lg);"
  >
    <span class="relative z-10 flex items-center justify-center">
      Send Message
      <svg class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
      </svg>
    </span>
  </button>
  
  <div id="form-message" class="hidden text-center glass border border-green-500/30 bg-green-500/10" style="font-size: var(--font-size-sm); padding: var(--spacing-2); border-radius: var(--radius-md);"></div>
</form>

<script>
  const form = document.getElementById('contact-form');
  const messageDiv = document.getElementById('form-message');
  
  // Handle floating labels
  const inputs = form?.querySelectorAll('input, textarea');
  inputs?.forEach(input => {
    const label = input.nextElementSibling as HTMLLabelElement;
    if (!label) return;
    
    // Function to update label position
    function updateLabel() {
      if (input.value || document.activeElement === input) {
        // Move label up when input has value or is focused
        label.style.top = '-0.5rem';
        label.style.fontSize = 'var(--font-size-sm)';
        label.style.color = 'rgb(96 165 250)';
        label.style.backgroundColor = 'rgba(15, 20, 25, 0.95)';
        label.style.padding = '0 0.5rem';
        label.style.borderRadius = 'var(--radius-sm)';
      } else {
        // Reset label position when input is empty and not focused
        label.style.top = 'var(--input-padding-y)';
        label.style.fontSize = 'var(--font-size-base)';
        label.style.color = 'rgb(148 163 184)';
        label.style.backgroundColor = 'transparent';
        label.style.padding = '0';
        label.style.borderRadius = '0';
      }
    }
    
    // Check initial state
    updateLabel();
    
    // Update on input
    input.addEventListener('input', updateLabel);
    
    // Update on focus
    input.addEventListener('focus', updateLabel);
    
    // Update on blur
    input.addEventListener('blur', updateLabel);
  });
  
  if (form && messageDiv) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Get form data
      const formData = new FormData(form);
      const name = formData.get('name');
      const email = formData.get('email');
      const message = formData.get('message');
      
      // Show loading state
      const submitButton = form.querySelector('button[type="submit"]');
      const originalButtonText = submitButton?.innerHTML;
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="relative z-10 flex items-center justify-center">Sending...</span>';
      }
      
      // Get configuration from form data attributes
      const recipientEmail = form.dataset.recipientEmail || 'Ramizbhaipinjara@gmail.com';
      const accessKey = form.dataset.accessKey || '';
      const useWeb3Forms = accessKey && accessKey !== 'YOUR_ACCESS_KEY_HERE' && accessKey.trim() !== '';
      
      if (useWeb3Forms) {
        try {
          // Use Web3Forms API
          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({
              access_key: accessKey,
              subject: `Contact Form Submission from ${name}`,
              from_name: name,
              from_email: email,
              message: message,
              to_email: recipientEmail
            })
          });
          
          const result = await response.json();
          
          if (result.success) {
            // Success
            messageDiv.classList.remove('hidden');
            messageDiv.classList.add('text-green-400');
            messageDiv.classList.remove('text-red-400');
            messageDiv.innerHTML = `
              <div class="flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span>Thank you for your message! I'll get back to you soon.</span>
              </div>
            `;
            
            form.reset();
            // Reset labels after form reset
            inputs?.forEach(input => {
              const label = input.nextElementSibling as HTMLLabelElement;
              if (label) {
                label.style.top = 'var(--input-padding-y)';
                label.style.fontSize = 'var(--font-size-base)';
                label.style.color = 'rgb(148 163 184)';
                label.style.backgroundColor = 'transparent';
                label.style.padding = '0';
              }
            });
          } else {
            throw new Error(result.message || 'Submission failed');
          }
        } catch (error) {
          console.error('Email submission error:', error);
          // Show error message
          messageDiv.classList.remove('hidden');
          messageDiv.classList.add('text-red-400');
          messageDiv.classList.remove('text-green-400');
          messageDiv.innerHTML = `
            <div class="flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
              <span>Failed to send message. Please try again or email directly to: <a href="mailto:${recipientEmail}" class="underline">${recipientEmail}</a></span>
            </div>
          `;
        }
      } else {
        // Fallback: Show instructions to configure Web3Forms
        messageDiv.classList.remove('hidden');
        messageDiv.classList.add('text-yellow-400');
        messageDiv.classList.remove('text-green-400', 'text-red-400');
        messageDiv.innerHTML = `
          <div class="flex flex-col items-center justify-center gap-2 text-center">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span class="font-semibold">Email service not configured</span>
            <span class="text-sm">Please configure Web3Forms to enable email delivery. For now, you can email directly: <a href="mailto:${recipientEmail}" class="underline text-blue-400">${recipientEmail}</a></span>
          </div>
        `;
        
        // Also open mailto as temporary solution
        const subject = encodeURIComponent(`Contact Form Submission from ${name}`);
        const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`);
        window.location.href = `mailto:${recipientEmail}?subject=${subject}&body=${body}`;
      }
      
      // Restore button
      if (submitButton) {
        submitButton.disabled = false;
        if (originalButtonText) {
          submitButton.innerHTML = originalButtonText;
        }
      }
      
      // Scroll to message
      messageDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      // Hide message after 8 seconds
      setTimeout(() => {
        messageDiv.classList.add('hidden');
      }, 8000);
    });
  }
</script>

<style>
  /* Floating label styles are now handled by JavaScript for better control */
  .form-group {
    position: relative;
  }
  
  .form-group label {
    transition: all 0.2s ease;
  }
</style>

